<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Workshop02 - YOLO  WebCam Realtime</title>

	<!--
		STYLE หลักของหน้า:
		- ใช้ flex layout เป้าหมายให้ UI เป็น step 1-2-3
		- มี video + canvas 2 ชั้น (overlay และ frame สำหรับส่งภาพขึ้นเซิร์ฟเวอร์)
	-->
	<style>
		/* แถวแนวนอนของ UI */
		.flex-row {
			margin: 10px;
			display: flex;
			flex-direction: row;
			align-items: flex-start;
		}
		/* กล่องแนวตั้ง (รวบ input ที่เกี่ยวกัน) */
		.flex-col {
			margin: 10px;
			display: flex;
			flex-direction: column;
			align-items: flex-start;
		}
		/* กล่องย่อยมีกรอบ/เงาให้เห็นขอบเขต */
		.flex-item {
			margin: 3px;
			padding: 10px;
			border: 1px solid #ccc;
			border-radius: 5px;
			box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
		}
		/* class อรรถประโยชน์: ซ่อน/แสดง */
		.hide { display: none; }
		.show { display: block; }

		/* NOTE: ควรระบุหน่วย px ให้ชัด (ตอนนี้เป็น 13 เฉย ๆ ซึ่งไม่ถูกต้องตามสเปก) */
		#videoElement {
			position: absolute;
			top: 13;  /* TODO: เปลี่ยนเป็น 13px */
			left: 13; /* TODO: เปลี่ยนเป็น 13px */
			z-index: 1; /* ให้อยู่ชั้นล่างกว่า overlay */
		}
		/* เฟรมดิบสำหรับส่งขึ้นเซิร์ฟเวอร์ (ไม่ต้องให้ผู้ใช้เห็น) */
		#canvasFrame {
			visibility: hidden; /* ซ่อนแต่ยังคงวาด/อ่านพิกเซลได้ */
		}
		/* overlay สำหรับวาดผลลัพธ์ (bbox/segment/pose/obb) ทับบน video */
		#canvasOverlay {
			position: absolute;
			top: 13;  /* TODO: เปลี่ยนเป็น 13px ให้ตรงกับ video */
			left: 13; /* TODO: เปลี่ยนเป็น 13px ให้ตรงกับ video */
			z-index: 2; /* ให้อยู่บน video */
		}
	</style>

	<!-- 
		เชื่อมโยงไฟล์ JavaScript ที่ควบคุมการทำงานของหน้า (ES Module)
		โหลดจาก static folder ของ Flask
	-->
	<script src="{{ url_for('static', filename='workshop02.js') }}" type="module"></script>
</head>

<body>
	<!-- ====================== STEP 1: เปิดสิทธิ์กล้อง + เลือกอุปกรณ์ ====================== -->
	<div class="flex-row">
		<div class="flex-item">1.</div>

		<!-- ปุ่มเริ่มขอสิทธิ์เข้าถึงกล้อง (navigator.mediaDevices.getUserMedia) -->
		<div class="flex-item">
			<button type="button" id="start">เริ่มเข้าถึงกล้อง</button>
		</div>

		<!-- รายการอุปกรณ์กล้องที่พบ (จะเติมรายการด้วย JS หลังจาก getUserMedia/ enumerateDevices) -->
		<div class="flex-item">
			<select id="webcamSelect">
				<option value="" selected>(เลือกกล้อง)</option>
			</select>
		</div>
	</div>

	<!-- ====================== STEP 2: เชื่อมต่อเซิร์ฟเวอร์ + ตั้งค่าพารามิเตอร์ ====================== -->
	<div class="flex-row">
		<div class="flex-item">2.</div>

		<!-- ปุ่ม Connect จะเปิด socket และเริ่มลูปส่งเฟรม (จัดการใน workshop02.js) -->
		<div class="flex-item">
			<button id="connectButton">Connect</button>
		</div>

		<!-- กล่องพารามิเตอร์สำหรับ YOLO: confidence / IoU / task -->
		<div class="flex-col flex-item">
			<div class="flex-row">
				<div class="flex-item">
					<label for="confidence">Confidence:</label>
					<!-- range 0.00–1.00 -->
					<input type="number" id="confidence" min="0.00" max="1.00" value="0.50" step="0.01">
				</div>
				<div class="flex-item">
					<label for="iou">IOU:</label>
					<input type="number" id="iou" min="0.00" max="1.00" value="0.45" step="0.01">
				</div>
			</div>

			<div class="flex-row">
				<div class="flex-item">
					<!-- เลือกชนิดงาน YOLO -->
					<select id="tasksSelect">
						<option value="detect">Task: Detect</option>
						<option value="segment">Task: Segment</option>
						<option value="classify">Task: Classify</option>
						<option value="pose">Task: Pose</option>
						<option value="obb">Task: OBB</option>
					</select>
				</div>
			</div>
		</div>

		<!-- ปุ่ม Disconnect หยุดส่งเฟรม/ปิด socket -->
		<div class="flex-item">
			<button id="disconnectButton">Disconnect</button>
		</div>
	</div>

	<!-- ====================== STEP 3: แสดงวิดีโอจากกล้อง + วาดผลลัพธ์ทับบน overlay ====================== -->
	<!--
		ทำ container เป็น position:relative เพื่อให้ child absolute (#videoElement, #canvasOverlay) อ้างอิงตำแหน่งได้
		NOTE: ใช้ webcam ต้องเปิดหน้าเว็บผ่าน HTTPS (หรือ localhost) ถึงจะขอสิทธิ์กล้องได้
	-->
	<div class="flex-row" style="position: relative;">
		<div class="flex-item">3.</div>
		<div class="flex-item">
			<!-- 
				video จาก getUserMedia จะถูก set เป็น srcObject ใน JS
				- playsinline: ป้องกัน iOS เปิดเต็มจอ
				- controls/loop: ไม่จำเป็นมากกับกล้อง (ใส่ไว้ก็ไม่ผิด)
			-->
			<video id="videoElement" autoplay playsinline controls loop></video>

			<!-- overlay สำหรับวาดผลลัพธ์จากเซิร์ฟเวอร์ (bbox, mask, keypoints, obb) -->
			<canvas id="canvasOverlay"></canvas>

			<!-- frame canvas ใช้เป็นแหล่งข้อมูลภาพที่จะ encode (JPEG/PNG) แล้วส่งขึ้นเซิร์ฟเวอร์ -->
			<canvas id="canvasFrame"></canvas>
		</div>
	</div>
</body>
</html>
